---
title: SMPP-protocolanalyse met [!DNL Wireshark]
description: Beschrijving
solution: Campaign
product: Campaign
applies-to: Campaign Classic
keywords: KCS, SMPP, Wireshark
resolution: Resolution
internal-notes: null
bug: false
article-created-by: Craig Thonis
article-created-date: 5/6/2022 3:51:03 PM
article-published-by: Craig Thonis
article-published-date: 5/6/2022 3:52:19 PM
version-number: 4
article-number: KA-17506
dynamics-url: https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=9319e64e-54cd-ec11-a7b5-6045bd00d4f5
exl-id: 39c89da2-36ae-4c66-9553-cfc3d5b4003a
source-git-commit: 0c3e421beca46d9fe1952b1f98538a50697216a0
workflow-type: tm+mt
source-wordcount: '2415'
ht-degree: 0%

---

# SMPP-protocolanalyse met [!DNL Wireshark]

## Beschrijving

<br>Leer om verkeer te analyseren SMPP gebruikend [!DNL Wireshark].<br><br><br><br><br>Inleiding<br><br><br><br> <br><br>
De meeste high-through SMS-C zijn compatibel met versie 3.4 van het SMPP-protocol. Dit protocol staat het verzenden van SMS en het ontvangen van informatie over de levering van dit SMS toe. Het protocol SMPP wordt gedocumenteerd in de specificatie van het Protocol SMPP v3.4 beschikbaar op Internet als document van de PDF.

Dit artikel komt niet in de plaats van dit productdossier: het geeft praktische tips over hoe de protocolspecificatie moet worden geïnterpreteerd en met het [!DNL Wireshark] om problemen tussen Adobe Campaign en de partner SMS-C op te lossen.

Aangezien het protocol SMPP vele verschillende delen aan de interpretatie van het implementatieteam nog bevat, zijn er verschillen tussen verschillende SMS-C.

Wanneer het oplossen van problemenproblemen, altijd contacteer de SMS-C partner om informatie te verkrijgen of u te helpen tweemaal controleren wat u krijgt. Als SMS-C met een fout antwoordt, zal uw partner SMS-C de beste persoon zijn om u te vertellen waarom het met de fout antwoordde. Als u een simulator SMPP in plaats van het verbinden met echte SMS-C gebruikt, zou u de broncode (of debugger) moeten gebruiken om te begrijpen wat gebeurt.


## Resolutie

<br><br>Vastleggen van netwerkverkeer zonder [!DNL Wireshark]<br><br><br><br><br><br>
Als u geen directe toegang tot de machine hebt, kan het noodzakelijk zijn om te vangen gebruikend bevel-lijn hulpmiddelen zoals *tcpdump*. Als u reeds de haven van TCP van de verbinding kent, zet de correcte filter vermijden vangend al verkeer. Hier volgt een voorbeeld `tcpdump` opdrachtregel voor vastleggen van poort `12345` tot <b>`outfile.pcap`</b>:


| `tcpdump -i any -w outfile.pcap tcp port 12345` |
| --- |


Het bestand <b>`outfile.pcap`</b> kan vervolgens worden geopend in [!DNL Wireshark] voor verdere analyse.


<br><br>[!DNL Wireshark] afhandeling<br><br><br><br> <br><br><br><br>
Dit onderwerp veronderstelt dat u met de grondbeginselen van vertrouwd bent [!DNL Wireshark]: het vangen van pakketten, het bepalen van eenvoudige filters, lezend pakketdetails. Een korte inleiding is beschikbaar op [Hoe wordt [!DNL Wireshark] om, pakketten van de Filter, en van Inspect te vangen](https://www.howtogeek.com/104278/how-to-use-wireshark-to-capture-filter-and-inspect-packets/).

Om SMPP verkeer binnen uit te filteren [!DNL Wireshark]Er zijn drie belangrijke kenmerken:

- Gebruik een vertoningsfilter op de haven van SMS-C. Bijvoorbeeld als SMS-C haven gebruikt `10000`gebruikt u het volgende filter:
   *`tcp.port == 10000`*


Om pakketten door telefoonaantal of door tekstinhoud te isoleren, gebruik de onderzoekseigenschap met de volgende montages:
![smpp1](https://helpx.adobe.com/content/dam/help/en/campaign/kb/smpp-protocol-wireshark/jcr_content/main-pars/image/smpp1.png "smpp1")
- Gebruik de <b>TCP-stroom volgen</b> om de stream te isoleren waaraan u werkt.
Sluit het rode/blauwe tekstvenster dat verschijnt omdat het alleen nuttig is voor tekstprotocollen die niet relevant zijn voor SMPP.
   ![smpp2](https://helpx.adobe.com/content/dam/help/en/campaign/kb/smpp-protocol-wireshark/jcr_content/main-pars/image_964579199/smpp2.png "smpp2")



<br><br><br><br>SMPP-protocol<br><br> <br><br>
Het protocol werkt over TCP en is volledig binair, betekenend dat de speciale hulpmiddelen zoals [!DNL Wireshark] (of een hexadecimale redacteur) worden vereist om de inhoud van de stroom te decrypteren.

De stroom bestaat uit onafhankelijke PDUs: elke PDU is een bericht dat een bevel, een status, een opeenvolgingsaantal, en andere informatie bevat die op het bevel wordt gebaseerd.

Wegens de aard van TCP als stroomprotocol, kan een pakket van TCP meer dan één PDU bevatten, en PDUs kan over 2 of meer pakketten van TCP overspannen. [!DNL Wireshark] PDU&#39;s opnieuw samenstellen, zodat deze meestal transparant zijn voor de [!DNL Wireshark] gebruiker.

Hier is een voorbeeld van PDUs die door het netwerk overgaan wanneer het verzenden van MT, dan het ontvangen van SR:
![smpp3](https://helpx.adobe.com/content/dam/help/en/campaign/kb/smpp-protocol-wireshark/jcr_content/main-pars/image_388497282/smpp3.png "smpp3")
Opmerking:

De lijst van standaardbevelen kan in sectie 5.1.2.1 van de specificatie worden gevonden SMPP (de reeks van het Bevel SMPP).
<br><br><br><br><br><br>SMPP-reacties<br><br><br><br> <br><br>
Het protocol SMPP vereist alle bevelen om door reactie PDU worden erkend:

`BIND_TRANSMITTER` wordt erkend door *`BIND_TRANSMITTER_RESP`*, *`SUBMIT_SM`* wordt erkend door *`SUBMIT_SM_RESP`*, enz.

Er is een time-out voor reacties, deze duurt doorgaans 10, 30 of 60 seconden. De reactie kan een positieve bevestiging bevatten (`command _status = 0`) of een fout (zie 5.1.3) *`command_status`*, *tabel 5-2* in de SMPP-specificatie voor de lijst van standaardfouten). Meestal zijn deze reacties onmiddellijk en is er geen time-out voor de reactie bereikt.

Let op het verschil tussen SMPP-responsfouten en SR-foutcodes: dezelfde foutcode kan verschillende dingen betekenen in de antwoordfout of in het veld SR-fout. Wanneer u een foutcode rapporteert, moet u heel voorzichtig zijn met waar u deze hebt gevonden, omdat de betekenis van de waarde afhankelijk is van de context.
<br><br><br><br><br><br>initialisatie van SMPP-verbinding<br><br><br><br><br><br>
De verbinding SMPP begint door het gebruiken van TCP te verbinden. Vervolgens een `BIND` bewerking is verzonden door [!DNL Campaign], erkend door `BIND RESP`. Deze activiteiten worden beschreven in punt 4.1 van de SMPP-specificatie (`BIND` bewerking).
![smpp4](https://helpx.adobe.com/content/dam/help/en/campaign/kb/smpp-protocol-wireshark/jcr_content/main-pars/image_468626174/smpp4.png "smpp4")
De bind verrichting doet login/wachtwoordcontrole en ruilt informatie over de platformnaam, de versie, en andere gebieden die in de specificatie worden beschreven.

Opmerking:

De aanmelding vindt u in het gedeelte `system_id` veld.



In [!DNL Campaign]dient u een *`BIND_TRANSMITTER`* pakket wanneer het in werking stellen van een overdracht MT en een *`BIND_RECEIVER`* pakket wanneer *`nlsm s`* activeert een MO/SR-verbinding.

<b>Verzender, ontvanger en zendontvanger: </b>De SMPP-aansluiting voor Campaign Classic werkt in een aparte zender-/ontvangermodus: er zijn twee verbindingen van TCP, voor het overbrengen van MT en een andere voor het ontvangen van MO en SR. Merk op dat de verbinding van TCP altijd in werking wordt gesteld door [!DNL Campaign], zelfs voor de ontvangermodus.

SMPP verstrekt ook een zendontvangerwijze, maar deze wijze wordt niet uitgevoerd in de schakelaar SMPP voor Campaign Classic.

De schakelaar SMPP gebruikt veelvoudige verbindingen parallel om MT over te brengen. Dit kan niet worden geregeld door de manier waarop de connector is ontworpen.
<br><br><br><br><br><br>Ontvangende GMO<br><br><br><br><br><br>
Wanneer de ontvanger gebonden is, kan SMS-C MO op elk ogenblik verzenden. De MO wordt verzonden via een *`DELIVER_SM`* PDU met beetjes 2-5 van *`esm_clas s`* duidelijk (vaak *`esm_class`* zal simpelweg 0 zijn).
![smpp5](https://helpx.adobe.com/content/dam/help/en/campaign/kb/smpp-protocol-wireshark/jcr_content/main-pars/image_695769115/smpp5.png "smpp5")
De *`DELIVER_SM`* PDU moet snel worden beantwoord door *`DELIVER_SM_RESP`* PDU met dezelfde *`sequence_number`*.
<br><br><br><br><br><br>MT wordt verzonden<br><br><br><br><br><br>
Om een MT te verzenden, moet de zender met succes worden gebonden. Controleer vóór alles of het bindingsproces met succes is uitgevoerd.

De MT wordt verzonden in een *`SUBMIT_SM`* PDU. SMS-C moet snel reageren met een *`SUBMIT_SM_RESP`* PDU: dit reactiepakket is speciaal omdat het identiteitskaart van het bericht in het gegevensbestand van SMS-C bevat (omvat altijd deze identiteitskaart wanneer het spreken met de partner SMS-C om hem te helpen het bericht sneller vinden). Deze id zal aanwezig zijn in de SR en is de enige manier om MT met zijn overeenkomstige SR aan te passen.

Het veld *`registered_delivery`* (beschreven in punt 5.2.17 van het productdossier) geeft aan SMS-C of een SR voor deze bijzondere MT wordt aangevraagd. Als u SR niet ontvangt voor een specifiek bericht, controleert u of het veld correct is ingesteld in het dialoogvenster *`SUBMIT_SM`* PDU.
![smpp5](https://helpx.adobe.com/content/dam/help/en/campaign/kb/smpp-protocol-wireshark/jcr_content/main-pars/image_1891077095/smpp5.png "smpp5")<br><br><br><br><br><br>Codering van MT<br><br><br><br><br><br>
Let op:

De codering van SMS is een complex onderwerp met vele vallen en diverse implementaties.


<br><br><br><br> <br><br>
De goede praktijk is altijd contacteren de SMS-C partner in het geval van het coderen problemen. Uw partner van SMS heeft een nauwkeurige kennis van de gesteunde het coderen en de speciale regels die wegens beperkingen in zijn technisch platform kunnen van toepassing zijn. Laat ze controleren wat je ze stuurt en wat ze je terugsturen, het is de enige weg naar een succesvolle en stabiele verbinding.

SMS-berichten gebruiken een speciale 7-bits codering, die vaak de GSM7-codering wordt genoemd. Zie [!DNL Wikipedia] GSM 03.38 (in het Engels).
<br><br><br><br> <br><br>
In het protocol SMPP, zal de tekst GSM7 tot 8 beetjes per karakter voor het gemakkelijkere oplossen van problemen worden uitgebreid. SMS-C verpakt het in 7 beetjes per karakter alvorens het naar mobiel wordt verzonden. Dit betekent dat het short_message gebied van SMS tot 160 bytes lang in het kader kan zijn SMPP terwijl het tot 140 bytes wanneer verzonden op het mobiele netwerk (het meest significante beetje wordt eenvoudig verworpen) beperkt is.

In het geval van coderingsproblemen moet u een aantal belangrijke zaken controleren:

- Controleer eerst of u weet tot welke tekens de codering behoort. GSM7 is berucht voor zijn gedeeltelijke steun aan diakritische tekens (accenten). Vooral in het Frans, waar é en è deel uitmaken van GSM7, maar ê, â of ï niet. De situatie is niet beter als het om Spaans gaat.
- De C met cedilla (ç) is alleen in hoofdletters aanwezig in het GSM7-alfabet, maar sommige telefoons geven het in kleine letters of in &quot;slimme&quot; gevallen weer: de algemene aanbeveling is om dit volledig te vermijden en de cedilla (die in het Frans nog steeds zeer leesbaar is) of de overgang naar UCS-2 te schrappen.
- Gebruik ASCII niet in SMS, tenzij uitdrukkelijk gevraagd door de partner SMS-C: deze codering verspilt ruimte omdat deze 8-bits tekens bevat en minder dekking heeft dan GSM7.
- Latin-1 wordt niet altijd ondersteund: controleer de verenigbaarheid met uw partner SMS-C alvorens om Latin-1 te proberen te gebruiken.
- Tabellen voor nationale taalverschuiving worden niet ondersteund door de Adobe Campaign Classic-connector. U moet UCS-2 in plaats daarvan gebruiken.
- UCS-2 en UTF-16 worden vaak gemengd door telefoons. Dit is een probleem voor mensen die emoji en andere zelden gebruikte karakters verzenden die niet in UCS-2 aanwezig zijn.
- De GSM7-codering wordt niet ondersteund door [!DNL Wireshark]: speciale tekens worden onjuist weergegeven. Als u moet controleren of een GSM7 koord behoorlijk wordt gecodeerd, moet u hexadecimale codes met de GSM7 lijst vergelijken.


De *`data_coding`* in het veld wordt aangegeven welke codering wordt gebruikt. Het enige probleem is dat de waarde 0 standaard SMS-C-codering in de specificatie betekent, maar in het algemeen GSM7. Controleer met SMS-C *partner welke codering wordt geassocieerd aan `data_coding = 0` (Adobe Campaign ondersteunt alleen GSM7 voor `data_coding* = 0`).

De maximumgrootte van een bericht hangt van zijn codering af. In deze tabel worden alle relevante gegevens samengevat:
<br><br><br><br> <br>

| Codering | data_coding | Berichtgrootte (tekens)  | Onderdeelformaat voor SMS met meerdere onderdelen  | Beschikbare tekens  |
| --- | --- | --- | --- | --- |
| GSM7 | 0 | 160 | 152 | [Basistekenset GSM7 + extensie](https://en.wikipedia.org/wiki/GSM_03.38) (uitgebreide tekens nemen 2 tekens in beslag)  |
| Latin-1  | 3 | 140 | 134 | ISO-8859-1 |
| UCS-2 UTF-16  | 8 | 70 | 67 | Unicode (verschilt per telefoon) |

<br><br><br><br><br>Gebruikersgegevenskoptekst (UDH)<br><br><br><br><br><br>
UDH (User Data Header) zijn kleine binaire kopteksten die aan de tekst van SMS worden toegevoegd. Zij kunnen speciale eigenschappen zoals de aaneenschakeling van SMS, nationale lijsten van de taalverschuiving, (zelden gebruikte) logo&#39;s/beelden of de duw van de WAP teweegbrengen.

Aangezien de UDH deel uitmaakt van het tekstveld (SMPP-veld short_message), wordt de effectieve grootte van een SMS-bericht verkort. Bijvoorbeeld, zal een samengevoegde LUSH van SMS 6 bytes per het deel van SMS (dat 6 echte 8 beetjebytes is, niet 7 beetjekarakters) verbruiken, die genoeg ruimte voor slechts 152 7 beetjekarakters per berichtdeel verlaten.

[!DNL Wikipedia] bevat handige artikelen over Gebruikersgegevenskoptekst en Samengevoegde SMS (in het Engels).

Om te weten of een short_message een UDH bevat, controleer beetjes 6 en 7 van esm_class (zie sectie 5.2.12 van de specificatie). [!DNL Wireshark] parseert UDH in de interface en geeft nauwkeurige informatie.
![smpp7](https://helpx.adobe.com/content/dam/help/en/campaign/kb/smpp-protocol-wireshark/jcr_content/main-pars/image_738682084/smpp7.png "smpp7")
In het bovenstaande schermafbeelding kunt u de koptekst van gebruikersgegevens zien in het berichtveld (1), in de UDH (2) opgenomen informatie en enige extra informatie die niet bij het pakket hoort, maar die door [!DNL Wireshark] (3) Het hoofdtekstveld van het bericht Kort is vooral interessant omdat het het volledige bericht bevat dat opnieuw is samengesteld door [!DNL Wireshark].
<br><br><br><br><br><br>SR ontvangen<br><br><br><br><br><br>
Wanneer de ontvanger gebonden is, kan sms-c SR op elk ogenblik verzenden. SR wordt verzonden gebruikend een PDU DELIVER_SM met beetjes 2-5 van *`esm_class`*set.
![smpp8](https://helpx.adobe.com/content/dam/help/en/campaign/kb/smpp-protocol-wireshark/jcr_content/main-pars/image_158644074/smpp8.png "smpp8")
De *`DELIVER_SM`* PDU moet snel worden beantwoord door *`DELIVER_SM_RESP`* PDU met dezelfde *`sequence_number`*. Als u de MT-overeenkomst met deze SR wilt zoeken, zoekt u naar een *`SUBMIT_SM_RESP`* met dezelfde id. Dit is bijvoorbeeld de MT die overeenkomt met de SR:
![smpp9](https://helpx.adobe.com/content/dam/help/en/campaign/kb/smpp-protocol-wireshark/jcr_content/main-pars/image_1012110897/smpp9.png "smpp9")
SR worden alleen verzonden als de *`registered_delivery`* wordt ingesteld in het MT.

Opmerking:

Adobe Campaign Classic SMPP-aansluiting kan SR die aankomt vóór de *`SUBMIT_SM_RESP`* pakket. Dit gedrag is niet expliciet in de specificatie verboden, maar het wordt als slecht gedrag beschouwd (het zou betekenen dat het bericht is ontvangen voordat het is verzonden). Als u dit geval te vaak ontmoet, vraag uw sms-c partner om zijn platform te bevestigen.
<br><br><br><br><br><br>Het veld short_message van SR decoderen<br><br><br><br><br><br>
Het tekstveld van de SR PDU&#39;s heeft een speciale codering die wordt beschreven in aanhangsel B van de specificatie voor het SMPP-protocol. Helaas, is dit formaat slechts een aanbeveling zonder deel van het protocol te uitmaken, hoewel de meeste SMS-C meer of minder dit formaat respecteert.

U zou de partner SMS-C voor een documentatie van zijn eigen implementatie en tweemaal controle direct moeten vragen dat het aanpast wat u in ziet [!DNL Wireshark]. Meestal weten de SMS-C-implementatoren hun implementatie niet eens en dit leidt tot problemen en misverstanden. Aarzel niet om de partner SMS-C om hulp te vragen als er om het even welke twijfels over dit gebied (vooral de foutencodes) zijn.

Het basisformaat is als volgt:

*`id:IIIIIIIIII sub:SSS dlvrd:DDD submit date:YYMMDDhhmm done date:YYMMDDhhmm stat:DDDDDDD err:EEE`*

*`Text:........`*

Dit zijn algemene richtlijnen voor het lezen van de bovenstaande regel:

- De id is hetzelfde als de id die is verzonden in de *`SUBMIT_SM_RESP`*van de overeenkomende MT.
- U kunt problemen negeren in het dialoogvenster `text` veld: dit veld wordt genegeerd door [!DNL Campaign] omdat het nutteloos, onbetrouwbaar is en zelfs volledig onleesbaar als SMS met een andere codering dan zuivere alfanumerieke ASCII werd verzonden. Dit is normaal gedrag.
- Veldnamen zijn niet hoofdlettergevoelig (bijvoorbeeld `id`: `sub`: `Text`: kan ook worden opgemerkt zoals `ID`: `SUB`: `text`:).
- De *`dlvrd`*field is over het algemeen niet betrouwbaar, tenzij gedocumenteerd door de partner SMS-C.
- De datums kunnen een tijdzone hebben, waardoor ze praktisch nutteloos worden, of ze zijn gewoon fout omdat de klok van de externe server uit is.
- De *`stat`*field kan andere waarden hebben dan die welke in aanhangsel B zijn gedefinieerd. Gebruik gezond verstand en de documentatie van de SMSC-partner om de betekenis ervan te begrijpen.
- De *`err`*field is volledig afhankelijk van SMS-C, en het grootste deel van de tijd die door de partner SMS-C wordt gedocumenteerd. Code 000 betekent vaak een succes, terwijl andere code fouten aangeeft. Het veld is vaak numeriek, maar kan ook hexadecimaal zijn.

<br><br><br><br><br><br>Meerdere SR&#39;s voor dezelfde MT<br><br><br><br><br><br>
Sommige sms-c verzenden veelvoudige sr voor zelfde MT om de vooruitgang van MT in het netwerk te volgen. Dit is meestal nutteloos omdat de cliënt slechts wil weten wanneer het bericht werd ontvangen (dit is typisch laatste SR).

In twijfel, slechts werk aan recentste SR die van SMS-C wordt ontvangen om de staat van een bericht te vinden.
<br><br><br><br><br><br>SMPP-venster<br><br><br><br><br><br>
Aangezien bewerkingen en reacties asynchroon zijn, kunt u de overdrachtsnelheden optimaliseren door meerdere PDU&#39;s voor bewerkingen te verzenden voordat u op de reacties wacht. Het aantal berichten dat geen antwoord heeft wordt genoemd het venster.

Voorbeeld van een transmissie met een maximum venster van 4:
![smpp10](https://helpx.adobe.com/content/dam/help/en/campaign/kb/smpp-protocol-wireshark/jcr_content/main-pars/image_2072040949/smpp10.png "smpp10")
De huidige implementatie controleert niet het venster en verwacht ver SMS-C snel genoeg om MT te behandelen.
