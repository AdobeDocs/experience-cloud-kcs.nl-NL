---
title: '"Neem draaddumps van een JVM.'
description: Beschrijving
solution: Experience Manager
product: Experience Manager
applies-to: "Experience Manager"
keywords: "KCS"
resolution: Resolution
internal-notes: null
bug: false
article-created-by: Roxann McGlumphy
article-created-date: "10/20/2021 6:41:42 PM"
article-published-by: Roxann McGlumphy
article-published-date: "10/20/2021 6:48:01 PM"
version-number: 1
article-number: KA-17452
dynamics-url: "https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=2e54c459-d531-ec11-b6e5-000d3a5ba97a"
exl-id: 9ad0fefe-b974-45d9-95b6-4a90f691f0cb
source-git-commit: 0c3e421beca46d9fe1952b1f98538a50697216a0
workflow-type: tm+mt
source-wordcount: '1052'
ht-degree: 0%

---

# Verbindingsdumpen maken van een JVM

## Beschrijving

<br><br><br>Hoe kan ik draaddumpen van een JVM op nemen [!DNL Linux], UNIX of [!DNL Windows]?<br><br><br><br> <br><br>
Een draadstortplaats is een lijst van al [!DNL Java] threads die momenteel actief zijn in een [!DNL Java Virtual Machine] (JVM).

Er zijn verscheidene manieren om draaddumps van JVM te nemen. Het wordt hoogst geadviseerd om meer dan 1 draadstortplaats te nemen. Een goede praktijk is 10 draaddumps met een regelmatig interval (bijvoorbeeld, één draadstortplaats om de tien seconden) te nemen.


## Resolutie

<br><br>Stap 1: De PID van uw [!DNL Java] proces<br><br><br><br> <br><br>
Het eerste stuk informatie u een draadstortplaats zult moeten kunnen verkrijgen is uw [!DNL Java] PID van proces.

De [!DNL Java] JDK wordt geleverd met de jps-opdracht die alle [!DNL Java] proces-id&#39;s. U kunt deze opdracht als volgt uitvoeren:


```
jps -l 70660 sun.tools.jps.Jps 70305
```


<b>Opmerking:</b> In [!DNL Linux] en UNIX, kunt u dit bevel als moeten in werking stellen `sudo -u user jps -l`, waarbij &quot;gebruiker&quot; de gebruikersnaam is van de gebruiker die [!DNL Java] proces wordt uitgevoerd als.

Als dit niet werkt of als u uw [!DNL Java] proces, (pad niet ingesteld, JDK niet geïnstalleerd of ouder) [!DNL Java] versie), gebruiken

- UNIX, [!DNL Linux]en Mac OS X: `ps -el | grep java`
- [!DNL Windows]: Druk op Ctrl+Shift+Esc om het taakbeheer te openen en de PID van het dialoogvenster [!DNL Java] proces

<br><br><br><br><br><br>Stap 2: Vraag een draadstortplaats van JVM<br><br><br><br><br><br><br><br>
<b>jstack</b>

Indien geïnstalleerd/beschikbaar, raden we u aan de <b>jstack</b> gebruiken. Het drukt draaddumps aan de console van de bevellijn.

Om een draadstortplaats te verkrijgen die jstack gebruikt, stel het volgende bevel in werking:
`jstack -l pid`

U kunt opeenvolgende draaddumps aan een dossier uitvoeren door de consoleoutput te gebruiken omleiden/toevoegt richtlijn:
`jstack -l pid  threaddumps.log`

Opmerkingen:

- Het jstack-gereedschap is beschikbaar vanaf JDK 1.5 (voor JVM op [!DNL Windows], is deze beschikbaar in sommige versies van JDK 1.5 en JDK 1.6).
- jstack werkt zelfs als de `-Xrs` jvm-parameter is ingeschakeld
- Het is niet mogelijk om het gereedschap Stapel van JDK 1.6 te gebruiken om threaddumps te nemen van een proces dat op JDK 1.5 loopt.
- In [!DNL Linux] en UNIX, moet u het bevel als gebruiker in werking stellen die het java proces bezit:

   `sudo -u *java-user* jstack -l *pid*`  

   (Java-gebruiker moet worden vervangen door de id van de gebruiker die [!DNL Java] proces wordt uitgevoerd als)
- In [!DNL Windows], als u jstack uitvoert en de fout &quot;Onvoldoende opslagruimte is beschikbaar om deze opdracht te verwerken&quot; krijgt, moet u jstack uitvoeren als de gebruiker van het Windows-SYSTEEM of de gebruiker die eigenaar is van het Java-proces.  U kunt dit doen door psexec te gebruiken dat u kunt downloaden [hier](http://technet.microsoft.com/en-us/sysinternals/bb897553.aspx). Om jstack als gebruiker van het SYSTEEM in werking te stellen, gebruik een bevel als dit:

   `psexec -s jstack *pid*   threaddumps.log`

   Als u psexec niet op de server kunt installeren, dan kunt u een .bat dossier creëren dat het bevel bevat en het in werking stellen [met de [!DNL Windows] taakplanner (als verschillende gebruiker)](https://technet.microsoft.com/en-us/library/cc748993%28v=ws.11%29.aspx).
- Als het Java-proces niet reageert, kan het soms helpen om de optie te gebruiken <b>`-J-d64`</b> (op 64-bits systemen), bijvoorbeeld:

   `jstack -J-d64 -l *pid*  threaddumps.log`
- Als de jstack-opdracht (`jstack -l pid  threaddumps.log`) genereert hieronder fout 1 en voert vervolgens de opdracht uit als de gebruiker die eigenaar is van het Java-proces.  Bijvoorbeeld:

   `sudo -u sling jstack -l pid  threaddumps.log`



<br><br><br><br><br><br> <br><br><br><br>

```
Error attaching to process: sun.jvm.hotspot.debugger.DebuggerException: Can't attach to the process: ptrace(PTRACE_ATTACH, ..) failed for 22893: Operation not permitted

sun.jvm.hotspot.debugger.DebuggerException: sun.jvm.hotspot.debugger.DebuggerException: Can't attach to the process: ptrace(PTRACE_ATTACH, ..) failed for 22893: Operation not permitted

...

Caused by: sun.jvm.hotspot.debugger.DebuggerException: Can't attach to the process: ptrace(PTRACE_ATTACH, ..) failed for 22893: Operation not permitted

...

sun.jvm.hotspot.debugger.linux.LinuxDebuggerLocal$LinuxDebuggerLocalWorkerThread.run(LinuxDebuggerLocal.java:138)
```



<br><br>JSTACK-SCRIPT<br><br>
Hier is een [script](https://github.com/cqsupport/jstackSeries.sh/blob/master/jstackSeries.sh) (aangepast aan het [eclipse.org](http://wiki.eclipse.org/How_to_report_a_deadlock#jstackSeries_--_jstack_sampling_in_fixed_time_intervals_.28tested_on_Linux.29)) die een reeks draaddumps gebruikend jstack zal nemen.  Het neemt ook het cpu gebruik van het draadniveau gebruikend hoogste bevel.

Voer het als volgt uit:
`sudo -u *user*jstackSeries.sh *pid* *aemserveruser* *count* *delay*`

Bijvoorbeeld:
`sudo -u aemuser jstackSeries.sh 1234 aemserveruser 10 3`

- <b>1234</b> is de pid van de [!DNL Java] proces
- <b>cq5serveruser</b> is de [!DNL Linux] of UNIX-gebruiker die [!DNL Java] proces wordt uitgevoerd als
- <b>10</b> is hoeveel draaddumps u moet nemen
- <b>3</b> is de vertraging tussen elke stortplaats


<b>Opmerking: </b>De bovenste uitvoer heeft de native thread-id in decimale notatie, terwijl de stapeluitvoer het knooppunt in hexadecimale notatie heeft.  U kunt de hoge cpu draad van de hoogste output aan de stapeloutput aanpassen door draad identiteitskaart in hexadecimaal om te zetten.

Naast het bovenstaande script hebben we ook een vergelijkbare [[!DNL Windows] Powershell script en een Adobe AEM specifiek script op github](https://github.com/cqsupport/jstackSeries.sh).

<b>Thread Dump Tool voor Adobe Experience Manager</b>

Als u Adobe Experience Manager-producten gebruikt, kunt u [dit gereedschap](https://helpx.adobe.com/experience-manager/kb/thread-dumps-collection-analysis.html) om een eenvoudige UI voor het produceren van draaddumps te hebben.
<br><br>ALTERNATIEVE MANIEREN OM EEN DREAD DUMP TE VERKRIJGEN<br><br>
Als de <b>jstack</b> is niet beschikbaar, kunt u als volgt draaddumps nemen:

<b>Opmerking:</b> Sommige gereedschappen kunnen geen thread-dumps vanuit JVM gebruiken als de opdrachtregelparameter `-Xrs` is ingeschakeld. Als u problemen ondervindt met het gebruik van thread dumps, controleert u of deze optie is ingeschakeld.
<br><br>UNIX, Mac OS X en [!DNL Linux] (JDK 1.4 of lagere versie)<br><br>
In UNIX, Mac OS X en [!DNL Linux]kunt u een QUIT-signaal naar de [!DNL Java] proces om het te vertellen om een draadstortplaats aan standaardoutput uit te voeren.

1. Voer deze opdracht uit om dit te doen:

   `kill -QUIT *pid*`

   Mogelijk moet u deze opdracht uitvoeren als `sudo -u user kill -QUIT *pid*` waarbij &quot;gebruiker&quot; de gebruiker is die [!DNL Java] proces wordt uitgevoerd als.
2. Als u CQSE begint met het `crx-quickstart/server/start` script, dan worden uw thread-dumps uitgevoerd naar `crx-quickstart/server/logs/startup.log`. Als u een toepassingsserver van een derde gebruikt, zoals JBoss, [!DNL WebSphere], [!DNL Tomcat]Raadpleeg de documentatie bij de server om te achterhalen naar welk bestand de standaarduitvoer wordt gestuurd.

[!DNL Windows]:<br><br>JDK 1.X
1. Download javadump.exe (zie hieronder).
2. Start de JVM met deze drie argumenten (deze moeten in de juiste volgorde staan):

   `-XX:+UnlockDiagnosticVMOptions -XX:+LogVMOutput -XX:LogFile=*C:\temp\jvmoutput.log*`
3. Druk op Ctrl+Shift+Esc om Taakbeheer te openen.
4. De PID van de [!DNL Java] proces.
5. Voer vanaf de opdrachtregel de volgende handelingen uit

   `javadump.exe *pid*`
6. De draadstortplaats zal in verschijnen `jvmoutput.log` in stap 2 vermelde bestand.

<br><br>JDK 1.6<br><br>
Krijg een draadstortplaats van <b>jconsole</b> met een plug-in: 0

Hier is hoe u een draadstortplaats kunt verzoeken:

1. Voeg de volgende parameter toe aan de actieve jvm `Communique` : `-Dcom.sun.management.jmxremote`
2. Download en installeer JDK 1.6 (als dit nog niet is gebeurd).
3. Download en extraheer de [Hulpprogramma Thread Dump Analyzer](https://github.com/irockel/tda). 1
4. Uitvoeren `jconsole.exe` van JDK 1.6:

                               `jconsole.exe -pluginpath /path/to/file/tda.jar`
5. Klik op de knop <b>Draad-dumpen</b> tab.
6. Klik op de knop <b>Dump met verbindingen aanvragen</b> koppeling.

<b>Opmerking:</b> Als u AEM 6 gebruikt.\* en wilt de lopende draden waarnemen, kunt u verzoeken `http://host:port/system/console/status-Threads` om een draadlijst te krijgen. Nochtans, gelieve te merken op dat deze draaddumps niet met de analysehulpmiddelen van de draadstortplaats zoals samurai of tda zullen werken.<br><br>Van toepassing op<br><br>
Alle Adobe-producten die in een JVM worden uitgevoerd
<br><br>Hulpprogramma&#39;s voor Thread dump-analyse:<br><br>
0 [http://technet.microsoft.com/en-us/sysinternals/bb897553.aspx](http://technet.microsoft.com/en-us/sysinternals/bb897553.aspx)
1  [https://github.com/irockel/tda](https://github.com/irockel/tda)
2 [https://fastthread.io/](https://fastthread.io/)
3 [https://www.ibm.com/support/knowledgecenter/en/SSLLVC_5.0.0/com.ibm.esupport.tool.tmda.doc/docs/readme.htm](https://www.ibm.com/support/knowledgecenter/en/SSLLVC_5.0.0/com.ibm.esupport.tool.tmda.doc/docs/readme.htm)
