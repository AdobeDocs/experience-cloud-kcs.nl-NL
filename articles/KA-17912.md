---
title: Inschakelen in cache
description: Beschrijving
solution: Experience Manager
product: Experience Manager
applies-to: Experience Manager
keywords: KCS
resolution: Resolution
internal-notes: null
bug: false
article-created-by: Roxann McGlumphy
article-created-date: 2/7/2022 5:13:07 PM
article-published-by: Roxann McGlumphy
article-published-date: 2/7/2022 5:13:28 PM
version-number: 3
article-number: KA-17912
dynamics-url: https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=ee0f4935-3988-ec11-93b0-0022480837ff
exl-id: a5da3fc9-c0a0-4d5a-8369-a96dad9e2b49
source-git-commit: 0c3e421beca46d9fe1952b1f98538a50697216a0
workflow-type: tm+mt
source-wordcount: '1462'
ht-degree: 0%

---

# Inschakelen in cache

## Beschrijving

In dit document wordt uitgelegd hoe [!DNL dispatcher] caching gebeurt en hoe het kan worden gevormd<br><br>
[Inhoudsopgave](https://experienceleague.adobe.com/docs/experience-cloud-kcs/kbarticles/KA-17490.html)

## Resolutie


<b>Caching Directories</b>

Wij gebruiken de volgende standaardgeheim voorgeheugenfolders in onze basislijninstallaties

- Auteur

   - `/mnt/var/www/author`
- Uitgever

   - `/mnt/var/www/html`


Wanneer elke aanvraag de [!DNL dispatcher] de verzoeken volgen de gevormde regels om een plaatselijk caching versie aan reactie van in aanmerking komende punten te houden

<b>Opmerking:</b>

We houden gepubliceerde werklasten bewust gescheiden van de werkbelasting van de auteur, omdat Apache bij het zoeken naar een bestand in de DocumentRoot niet weet van welke AEM instantie het afkomstig is. Dus zelfs als u cache in de auteurshandel hebt uitgeschakeld, als DocumentRoot van de auteur het zelfde is als uitgever zal het dossiers van het geheime voorgeheugen indien heden dienen. Dit betekent dat u de auteursdossiers van de auteur voor van gepubliceerde geheime voorgeheugen zult dienen en voor een werkelijk afschuwelijke mengeling ervaring voor uw bezoekers zal maken. Het is ook een erg slecht idee om afzonderlijke DocumentRoot-mappen te houden voor verschillende gepubliceerde inhoud. U zult veelvoudige re-caching punten moeten tot stand brengen die niet tussen plaatsen zoals clientlibs verschillen evenals het moeten opstelling een replicatie spoelagent voor elke DocumentRoot u opstelling. Met activering van elke pagina wordt de mate van doorspoelen over de kop verhoogd. Vertrouw op naamruimte van bestanden en de bijbehorende paden in de volledige cache en vermijd meerdere DocumentRoot&#39;s voor gepubliceerde sites.



<b>Configuratiebestanden</b>

[!DNL Dispatcher] bepaalt wat in `/cache {` sectie van om het even welk landbouwbedrijfdossier. 
In de de basislijnconfiguratielandbouwbedrijven van AMS, zult u onze hieronder getoonde omvat vinden:


```
/cache { 
    /rules { 
        $include "/etc/httpd/conf.dispatcher.d/cache/ams_author_cache.any" 
    }
```


Raadpleeg de documentatie bij het maken van de regels voor wat u wilt opslaan of niet [hier](https://experienceleague.adobe.com/docs/experience-manager-dispatcher/using/configuring/dispatcher-configuration.html?lang=en#configuring-the-dispatcher-cache-cache)



<b>Auteur in cache</b>

Er zijn veel implementaties die we hebben gezien waar mensen geen auteursinhoud in cache plaatsen. 
Ze missen een enorme verbetering in prestaties en responsiviteit voor hun auteurs.

Laten wij over de strategie spreken die in het vormen van onze auteurshandel wordt genomen om behoorlijk in het voorgeheugen onder te brengen.

Hier volgt een basisauteur `/cache {` sectie van ons auteur landbouwdossier:


```
/cache { 
    /docroot "/mnt/var/www/author" 
    /statfileslevel "2" 
    /allowAuthorized "1" 
    /rules { 
        $include "/etc/httpd/conf.dispatcher.d/cache/ams_author_cache.any" 
    } 
    /invalidate { 
        /0000 { 
            /glob "*" 
            /type "allow" 
        } 
    } 
    /allowedClients { 
        /0000 { 
            /glob "*.*.*.*" 
            /type "deny" 
        } 
        $include "/etc/httpd/conf.dispatcher.d/cache/ams_author_invalidate_allowed.any" 
    } 
}
```


Het is belangrijk dat de <b>`/docroot`</b> wordt ingesteld op de cachemap voor de auteur.

<b>Opmerking:</b>

Zorg ervoor dat u `DocumentRoot` in de `.vhost` bestand komt overeen met de boerderijen `/docroot` parameter

De cacheregels bevatten de instructie die het bestand bevat <b>`/etc/httpd/conf.dispatcher.d/cache/ams_author_cache.any`</b> die deze regels bevat:


```
/0000 { 
 /glob "*" 
 /type "deny" 
} 
/0001 { 
 /glob "/libs/*" 
 /type "allow" 
} 
/0002 { 
 /glob "/libs/*.html" 
 /type "deny" 
} 
/0003 { 
 /glob "/libs/granite/csrf/token.json" 
 /type "deny" 
} 
/0004 { 
 /glob "/apps/*" 
 /type "allow" 
} 
/0005 { 
 /glob "/apps/*.html" 
 /type "deny" 
} 
/0006 { 
 /glob "/libs/cq/core/content/welcome.*" 
 /type "deny" 
}
```


In een auteurscenario, verandert de inhoud voortdurend en doelgericht. U wilt alleen items in cache plaatsen die niet vaak worden gewijzigd.
We hebben regels om in cache te plaatsen `/libs` omdat ze onderdeel zijn van de basislijn AEM installeren en worden gewijzigd totdat u een Service Pack, Cumulative Fix Pack, Upgrade of Hotfix hebt geïnstalleerd. Het in cache plaatsen van deze elementen heeft veel zin en heeft echt enorme voordelen van de ervaring van auteurs van eindgebruikers die de site gebruiken.

<b>Opmerking:</b>

Onthoud dat deze regels ook in het cachegeheugen worden opgeslagen <b>`/apps`</b> dit is waar de code van de douanetoepassing leeft. Als u uw code op deze instantie ontwikkelt dan zal het zeer verwarrend blijken te zijn wanneer u sparen uw dossier en niet ziet of in UI wegens het dienen van een caching exemplaar nadenken. De bedoeling is hier dat als u een plaatsing van uw code in AEM het doet het ook niet vaak zou zijn en een deel van uw plaatsingsstappen zou moeten zijn om het auteursgeheime voorgeheugen te ontruimen. Ook hier is het voordeel enorm, waardoor uw code sneller kan worden uitgevoerd voor de eindgebruikers.



<b>ServeOnStale (AKA Serve on Stale / SOS)</b>

Dit is een van die uitingen van een kenmerk van de [!DNL dispatcher]. Als de uitgever onder lading is of niet meer reageert zal het typisch een 502 of 503 http antwoordcode werpen. Als dat gebeurt en deze functie is ingeschakeld, wordt het [!DNL dispatcher] zal worden geïnstrueerd om nog te dienen wat de inhoud nog in het geheime voorgeheugen als beste inspanning is zelfs als het geen vers exemplaar is. Het is beter om iets te dienen als u het eerder dan enkel een foutenmelding hebt tonen die geen functionaliteit aanbiedt.

<b>Opmerking:</b>

Onthoud dat deze functie niet wordt geactiveerd wanneer de uitgeverrenderer een sockettime-out of een foutbericht van 500 heeft. Als AEM enkel onbereikbaar is, doet deze eigenschap niets

Dit plaatsen kan in om het even welk landbouwbedrijf worden geplaatst maar slechts steek houdt om het op toe te passen publiceert landbouwbedrijfdossiers. Hier is een syntaxisvoorbeeld van de eigenschap die in een landbouwbedrijfdossier wordt toegelaten:


```
/cache { 
    /serveStaleOnError "1"
```




<b>Pagina&#39;s met queryparams/argumenten in cache plaatsen</b>

<b>Opmerking:</b>

Een van de normale gedragingen van de [!DNL Dispatcher] de module is dat als een verzoek een vraagparameter in URI heeft (typisch getoond als `/content/page.html?myquery=value`) slaat het caching van het dossier over en gaat direct naar de AEM instantie. Het overweegt dit verzoek om een dynamische pagina en zou niet in het voorgeheugen ondergebracht moeten worden. Dit kan gevolgen voor geheim voorgeheugenefficiency veroorzaken.

Als u pagina&#39;s in AEM hebt die `GET` argumenten/vraagparameters in de adreslijn die de pagina helpen werken maar niet verschillende html teruggeven zijn goede kandidaten voor dit configuratieelement U kunt vertellen [!DNL dispatcher] welke argumenten om de pagina te negeren en nog steeds in de cache op te slaan.
Als voorbeeld heeft iemand een diepgaande-koppelingsverwijzingsmechanisme voor sociale media gebouwd dat de argumentverwijzing in URI gebruikt om te weten waar de persoon uit kwam.

<b>Voorbeeld:</b>

[https://www.retail.com/home.html?reference=android](https://www.retail.com/home.html?reference=android)

[https://www.retail.com/home.html?reference=facebook](https://www.retail.com/home.html?reference=facebook)

De pagina is 100% cacheable maar houdt geen cache omdat de argumenten aanwezig zijn. 
Om dit te werken, voegen wij de volgende sectie aan ons dossier van de landbouwbedrijfconfiguratie toe:


```
/cache { 
    /ignoreUrlParams { 
        /0001 { /glob "*" /type "deny" } 
        /0002 { /glob "reference" /type "allow" } 
    }
```


Wanneer de [!DNL dispatcher] ziet het verzoek het zal negeren dat het verzoek de vraagparameter van ?reference heeft en nog de pagina in het voorgeheugen onder brengen



<b>Responsheaders in cache plaatsen</b>

Het is vrij duidelijk dat het [!DNL dispatcher] caches `.html` pagina&#39;s en clientlibs, maar wist u dat bepaalde antwoordheaders ook in cache kunnen plaatsen naast de inhoud in een bestand met dezelfde naam, maar met een `.h` bestandsextensie. Hierdoor is de volgende reactie niet alleen mogelijk op de inhoud, maar ook op de antwoordheaders die ermee moeten worden verbonden vanuit de cache.

AEM kan meer dan alleen UTF-8-codering verwerken

Soms hebben de punten speciale kopballen die helpen de het coderen van geheime voorgeheugenTTL details controleren, en laatst veranderde timestamps.

Deze waarden worden standaard verwijderd wanneer ze in cache worden geplaatst en [!DNL apache] De httpd-webserver verwerkt het middel zelf met de normale bestandsafhandelingsmethoden, die normaal gesproken beperkt zijn tot het mime-type gissen op basis van bestandsextensies.

Als u de [!DNL dispatcher] het element en de gewenste koppen in cache plaatsen die u beschikbaar kunt maken voor de juiste ervaring en ervoor zorgen dat alle details dit maken voor de clientbrowser.

Hier is een voorbeeld van een landbouwbedrijf met de kopballen aan gespecificeerde geheime voorgeheugen:


```
/cache { 
 /headers { 
  "Cache-Control" 
  "Content-Disposition" 
  "Content-Type" 
  "Expires" 
  "Last-Modified" 
  "X-Content-Type-Options" 
 } 
}
```


In het voorbeeld hebben zij AEM gevormd om omhoog kopballen te dienen CDN zoekt om te weten wanneer om het cachegeheugen ongeldig te maken. Dit betekent dat AEM correct kan bepalen welke bestanden op basis van kopteksten ongeldig worden gemaakt.

<b>Opmerking:</b>

Onthoud dat u reguliere expressies of overeenkomende glob-expressies niet kunt gebruiken. Het is een letterlijke lijst van kopballen aan geheime voorgeheugen. Plaats dit alleen in een lijst met de letterlijke koppen die u in de cache wilt plaatsen.



<b>Respijtperiode automatisch ongeldig maken</b>

Op AEM systemen die veel activiteit hebben van auteurs die veel paginanavigaties uitvoeren, kunt u een zeldzame situatie hebben waarin herhaalde validaties voorkomen. Zware herhaalde verzoeken om uitspoelen zijn niet nodig en u kunt enige tolerantie gebruiken om een uitspoeling niet te herhalen totdat de respijtperiode is gewist.

<b>Voorbeeld van hoe dit werkt:</b>

Als u 5 verzoeken hebt om de validatie ongeldig te maken `/content/exampleco/en/` alles gebeurt binnen een periode van 3 seconden .

Met deze functie zou u de cachemap ongeldig maken `/content/exampleco/en/` 5 keer

Met deze functie ingeschakeld en ingesteld op 5 seconden, wordt de cachemap ongeldig gemaakt `/content/exampleco/en/` <b>eenmaal</b>

Hier is een voorbeeldsyntaxis van deze eigenschap die voor 5 tweede graadperiode wordt gevormd:


```
/cache { 
    /gracePeriod "5"
```




<b>Op TTL gebaseerde validatie</b>

Een nieuwere functie van de [!DNL dispatcher] module was <b>Te leven tijd (TTL)</b> gebaseerde validatieopties voor items in de cache. Wanneer een item in de cache wordt geplaatst, zoekt het naar de aanwezigheid van cachebeheerkoppen en genereert het een bestand in de cachemap met dezelfde naam en een <b>`.ttl`</b> extensie.

Hier is een voorbeeld van de eigenschap die in het dossier van de landbouwbedrijfconfiguratie wordt gevormd:


```
/cache { 
    /enableTTL "1"
```


<b>Opmerking:</b>

Houd in mening dat AEM nog moet worden gevormd om de kopballen van TTL te verzenden voor [!DNL dispatcher] om hen te eren. Als u deze functie inschakelt, wordt alleen de functie [!DNL dispatcher] om te weten wanneer om de dossiers te verwijderen die AEM hebben verzendt geheim voorgeheugencontrolekopballen voor. Als AEM niet begint met het verzenden van TTL-headers dan [!DNL dispatcher] zal hier niets bijzonders doen.



<b>Regels voor filter Cache</b>

Hier is een voorbeeld van een basislijnconfiguratie waarvoor elementen op een uitgever in het voorgeheugen onderbrengen:


```
/cache{ 
    /0000 { 
        /glob "*" 
        /type "allow" 
    } 
    /0001 { 
        /glob "/libs/granite/csrf/token.json" 
        /type "deny" 
    }
```


We willen onze gepubliceerde site zo hebzuchtig mogelijk maken en alles in de cache plaatsen.

Als er elementen zijn die de ervaring breken wanneer caching u regels kunt toevoegen om de optie te verwijderen om dat punt in het voorgeheugen onder te brengen. Zoals u in het voorbeeld hierboven ziet, mogen de csrf-tokens nooit in de cache worden geplaatst en zijn deze uitgesloten. Nadere bijzonderheden over het schrijven van deze regels zijn te vinden [hier](https://experienceleague.adobe.com/docs/experience-manager-dispatcher/using/configuring/dispatcher-configuration.html?lang=en#configuring-the-dispatcher-cache-cache)
