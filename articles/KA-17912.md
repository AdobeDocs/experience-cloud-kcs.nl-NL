---
title: Inschakelen in cache
description: Beschrijving
solution: Experience Manager
product: Experience Manager
applies-to: Experience Manager
keywords: KCS
resolution: Resolution
internal-notes: null
bug: false
article-created-by: Roxann McGlumphy
article-created-date: 2/7/2022 5:13:07 PM
article-published-by: Roxann McGlumphy
article-published-date: 2/7/2022 5:13:28 PM
version-number: 3
article-number: KA-17912
dynamics-url: https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=ee0f4935-3988-ec11-93b0-0022480837ff
exl-id: a5da3fc9-c0a0-4d5a-8369-a96dad9e2b49
source-git-commit: e8f4ca2dd578944d4fe399074fab461de88ad247
workflow-type: tm+mt
source-wordcount: '1517'
ht-degree: 0%

---

# Inschakelen in cache

## Beschrijving

Dit document zal verklaren hoe de verzender caching gebeurt en hoe het kan worden gevormd<br><br> <br><br>[Inhoudsopgave](https://experienceleague.adobe.com/docs/experience-cloud-kcs/kbarticles/KA-17490.html)

## Resolutie


<b>Caching Directories</b>

Wij gebruiken de volgende standaardgeheim voorgeheugenfolders in onze basislijninstallaties

- Auteur

   - /mnt/var/www/auteur
- Uitgever

   - /mnt/var/www/html


Wanneer elke aanvraag de verzender doorloopt, volgen de aanvragen de geconfigureerde regels om een versie in de lokale cache te behouden als reactie op subsidiabele items

<b>Opmerking:</b>

We houden gepubliceerde werklasten bewust gescheiden van de werkbelasting van de auteur, omdat Apache bij het zoeken naar een bestand in de DocumentRoot niet weet van welke AEM instantie het afkomstig is. Dus zelfs als u cache in de auteurshandel hebt uitgeschakeld, als DocumentRoot van de auteur het zelfde is als uitgever zal het dossiers van het geheime voorgeheugen indien heden dienen. Dit betekent dat u de auteursdossiers van de auteur voor van gepubliceerde geheime voorgeheugen zult dienen en voor een werkelijk afschuwelijke mengeling ervaring voor uw bezoekers zal maken. Het is ook een erg slecht idee om afzonderlijke DocumentRoot-mappen te houden voor verschillende gepubliceerde inhoud. U zult veelvoudige re-caching punten moeten tot stand brengen die niet tussen plaatsen zoals clientlibs verschillen evenals het moeten opstelling een replicatie spoelagent voor elke DocumentRoot u opstelling. Met activering van elke pagina wordt de mate van doorspoelen over de kop verhoogd. Vertrouw op naamruimte van bestanden en de bijbehorende paden in de volledige cache en vermijd meerdere DocumentRoot&#39;s voor gepubliceerde sites.



<b>Configuratiebestanden</b>

Dispatcher bepaalt wat als cacheable in de /cache {- sectie van om het even welk landbouwbedrijfdossier kwalificeert. 
In de de basislijnconfiguratielandbouwbedrijven van AMS, zult u onze hieronder getoonde omvat vinden:


```
/cache { 
    /rules { 
        $include "/etc/httpd/conf.dispatcher.d/cache/ams_author_cache.any" 
    }
```


Raadpleeg de documentatie bij het maken van de regels voor wat u wilt opslaan of niet [hier](https://experienceleague.adobe.com/docs/experience-manager-dispatcher/using/configuring/dispatcher-configuration.html?lang=en#configuring-the-dispatcher-cache-cache)



<b>Auteur in cache</b>

Er zijn veel implementaties die we hebben gezien waar mensen geen auteursinhoud in cache plaatsen. 
Ze missen een enorme verbetering in prestaties en responsiviteit voor hun auteurs.

Laten wij over de strategie spreken die in het vormen van onze auteurshandel wordt genomen om behoorlijk in het voorgeheugen onder te brengen.

Hier is een sectie van de basisauteur /cache { van ons dossier van het auteurslandbouwbedrijf:


```
/cache { 
    /docroot "/mnt/var/www/author" 
    /statfileslevel "2" 
    /allowAuthorized "1" 
    /rules { 
        $include "/etc/httpd/conf.dispatcher.d/cache/ams_author_cache.any" 
    } 
    /invalidate { 
        /0000 { 
            /glob "*" 
            /type "allow" 
        } 
    } 
    /allowedClients { 
        /0000 { 
            /glob "*.*.*.*" 
            /type "deny" 
        } 
        $include "/etc/httpd/conf.dispatcher.d/cache/ams_author_invalidate_allowed.any" 
    } 
}
```


Het is belangrijk dat de <b>/docroot</b> wordt ingesteld op de cachemap voor de auteur.

<b>Opmerking:</b>

Zorg ervoor dat de DocumentRoot in het .vhost-bestand van de auteur overeenkomt met de farm/docroot-parameter

De cacheregels bevatten de instructie die het bestand bevat <b>/etc/httpd/conf.dispatcher.d/cache/ams_author_cache.any</b> die deze regels bevat:


```
/0000 { 
 /glob "*" 
 /type "deny" 
} 
/0001 { 
 /glob "/libs/*" 
 /type "allow" 
} 
/0002 { 
 /glob "/libs/*.html" 
 /type "deny" 
} 
/0003 { 
 /glob "/libs/granite/csrf/token.json" 
 /type "deny" 
} 
/0004 { 
 /glob "/apps/*" 
 /type "allow" 
} 
/0005 { 
 /glob "/apps/*.html" 
 /type "deny" 
} 
/0006 { 
 /glob "/libs/cq/core/content/welcome.*" 
 /type "deny" 
}
```


In een auteurscenario, verandert de inhoud voortdurend en doelgericht. U wilt alleen items in cache plaatsen die niet vaak worden gewijzigd.
Wij hebben regels om /libs in het voorgeheugen op te slaan omdat zij deel van de basislijn uitmaken AEM installeren en zouden veranderen tot u een Service Pack, Cumulative Fix Pack, Verbetering, of Hotfix hebt geïnstalleerd. Het in cache plaatsen van deze elementen heeft veel zin en heeft echt enorme voordelen van de ervaring van auteurs van eindgebruikers die de site gebruiken.

<b>Opmerking:</b>

Onthoud dat deze regels ook in het cachegeheugen worden opgeslagen <b>/apps</b> dit is waar de code van de douanetoepassing leeft. Als u uw code op deze instantie ontwikkelt dan zal het zeer verwarrend blijken te zijn wanneer u sparen uw dossier en niet ziet of in UI wegens het dienen van een caching exemplaar nadenken. De bedoeling is hier dat als u een plaatsing van uw code in AEM het doet het ook niet vaak zou zijn en een deel van uw plaatsingsstappen zou moeten zijn om het auteursgeheime voorgeheugen te ontruimen. Ook hier is het voordeel enorm, waardoor uw code sneller kan worden uitgevoerd voor de eindgebruikers.



<b>ServeOnStale (AKA Serve on Stale / SOS)</b>

Dit is een van de onderdelen van een functie van de verzender. Als de uitgever onder lading is of niet meer reageert zal het typisch een 502 of 503 http antwoordcode werpen. Als dat gebeurt en deze eigenschap wordt toegelaten zal de verzender worden opgedragen om nog te dienen wat de inhoud nog in het geheime voorgeheugen als beste inspanning is zelfs als het geen vers exemplaar is. Het is beter om iets te dienen als u het eerder dan enkel een foutenmelding hebt tonen die geen functionaliteit aanbiedt.

<b>Opmerking:</b>

Onthoud dat deze functie niet wordt geactiveerd wanneer de uitgeverrenderer een sockettime-out of een foutbericht van 500 heeft. Als AEM enkel onbereikbaar is, doet deze eigenschap niets

Dit plaatsen kan in om het even welk landbouwbedrijf worden geplaatst maar slechts steek houdt om het op toe te passen publiceert landbouwbedrijfdossiers. Hier is een syntaxisvoorbeeld van de eigenschap die in een landbouwbedrijfdossier wordt toegelaten:


```
/cache { 
    /serveStaleOnError "1"
```




<b>Pagina&#39;s met queryparams/argumenten in cache plaatsen</b>

<b>Opmerking:</b>

Één van het normale gedrag van de module van de Verzender is dat als een verzoek een vraagparameter in URI heeft (typisch getoond zoals /content/page.html<b>?myquery=value</b>) slaat het caching van het dossier over en gaat direct naar de AEM instantie. Het overweegt dit verzoek om een dynamische pagina en zou niet in het voorgeheugen ondergebracht moeten worden. Dit kan gevolgen voor geheim voorgeheugenefficiency veroorzaken.

Als u pagina&#39;s in AEM hebt die GET argumenten/vraagparameters in de adreslijn nemen die de pagina helpen werken maar niet verschillende HTML teruggeven zijn goede kandidaten voor dit configuratieelement U kunt verzender vertellen welke argumenten om te negeren en nog de pagina in het voorgeheugen onder te brengen.
Als voorbeeld heeft iemand een diepgaande-koppelingsverwijzingsmechanisme voor sociale media gebouwd dat de argumentverwijzing in URI gebruikt om te weten waar de persoon uit kwam.

<b>Voorbeeld:</b>

[https://www.retail.com/home.html?reference=android](https://www.retail.com/home.html?reference=android)

[https://www.retail.com/home.html?reference=facebook](https://www.retail.com/home.html?reference=facebook)

De pagina is 100% cacheable maar houdt geen cache omdat de argumenten aanwezig zijn. 
Om dit te werken, voegen wij de volgende sectie aan ons dossier van de landbouwbedrijfconfiguratie toe:


```
/cache { 
    /ignoreUrlParams { 
        /0001 { /glob "*" /type "deny" } 
        /0002 { /glob "reference" /type "allow" } 
    }
```


Nu wanneer de verzender het verzoek ziet, zal het negeren het feit dat het verzoek de vraagparameter van ?reference heeft en nog de pagina in het voorgeheugen onderbrengen



<b>Responsheaders in cache plaatsen</b>

Het is vrij duidelijk dat de verzender .html pagina&#39;s en clientlibs in het voorgeheugen onderbrengt, maar wist u het bepaalde antwoordkopballen langs de inhoud in een dossier met de zelfde naam maar .h dossieruitbreiding kan ook in het voorgeheugen onderbrengen. Hierdoor is de volgende reactie niet alleen mogelijk op de inhoud, maar ook op de antwoordheaders die ermee moeten worden verbonden vanuit de cache.

AEM kan meer dan alleen UTF-8-codering verwerken

Soms hebben de punten speciale kopballen die helpen de het coderen van geheime voorgeheugenTTL details controleren, en laatst veranderde timestamps.

Deze waarden worden standaard verwijderd wanneer ze in de cache worden opgeslagen en de apache httpd-webserver verwerkt het element op basis van de normale bestandsafhandelingsmethoden. Normaal gesproken is dit beperkt tot Mime-type guessing op basis van bestandsextensies.

Als u het element en de gewenste kopteksten in de cache van de verzender hebt, kunt u de juiste ervaring weergeven en ervoor zorgen dat alle details het aan de clientbrowser doen.

Hier is een voorbeeld van een landbouwbedrijf met de kopballen aan gespecificeerde geheime voorgeheugen:


```
/cache { 
 /headers { 
  "Cache-Control" 
  "Content-Disposition" 
  "Content-Type" 
  "Expires" 
  "Last-Modified" 
  "X-Content-Type-Options" 
 } 
}
```


In het voorbeeld hebben zij AEM gevormd om omhoog kopballen te dienen CDN zoekt om te weten wanneer om het cachegeheugen ongeldig te maken. Dit betekent dat AEM correct kan bepalen welke bestanden op basis van kopteksten ongeldig worden gemaakt.

<b>Opmerking:</b>

Onthoud dat u reguliere expressies of overeenkomende glob-expressies niet kunt gebruiken. Het is een letterlijke lijst van kopballen aan geheime voorgeheugen. Plaats dit alleen in een lijst met de letterlijke koppen die u in de cache wilt plaatsen.



<b>Respijtperiode automatisch ongeldig maken</b>

Op AEM systemen die veel activiteit hebben van auteurs die veel paginanavigaties uitvoeren, kunt u een zeldzame situatie hebben waarin herhaalde validaties voorkomen. Zware herhaalde verzoeken om uitspoelen zijn niet nodig en u kunt enige tolerantie gebruiken om een uitspoeling niet te herhalen totdat de respijtperiode is gewist.

<b>Voorbeeld van hoe dit werkt:</b>

Als u 5 verzoek hebt om /content/exampleco/nl/all ongeldig te maken, gebeurt dit binnen een periode van 3 seconden.

Met deze functie zou u de cachemap /content/exampleco/nl/ 5 keer ongeldig maken

Met deze functie ingeschakeld en ingesteld op 5 seconden zou de cachemap /content/exampleco/nl/ ongeldig worden<b>eenmaal</b>

Hier is een voorbeeldsyntaxis van deze eigenschap die voor 5 tweede graadperiode wordt gevormd:


```
/cache { 
    /gracePeriod "5"
```




<b>Op TTL gebaseerde validatie</b>

Een nieuwere functie van de verzendermodule is <b>Te leven tijd (TTL)</b> gebaseerde validatieopties voor items in de cache. Wanneer een item in de cache wordt geplaatst, zoekt het naar de aanwezigheid van cachebeheerkoppen en genereert het een bestand in de cachemap met dezelfde naam en een <b>.ttl</b> extensie.

Hier is een voorbeeld van de eigenschap die in het dossier van de landbouwbedrijfconfiguratie wordt gevormd:


```
/cache { 
    /enableTTL "1"
```


<b>Opmerking:</b>

Houd in mening dat AEM nog moet worden gevormd om de kopballen van TTL voor dispatcher te verzenden om hen te respecteren. Als u deze functie in- en uitschakelt, kan de verzender alleen weten wanneer de bestanden worden verwijderd waarvoor AEM cachebeheerkoppen heeft verzonden. Als AEM niet begint met het verzenden van TTL-headers, zal de dispatcher hier niets speciaals doen.



<b>Regels voor filter Cache</b>

Hier is een voorbeeld van een basislijnconfiguratie waarvoor elementen op een uitgever in het voorgeheugen onderbrengen:


```
/cache{ 
    /0000 { 
        /glob "*" 
        /type "allow" 
    } 
    /0001 { 
        /glob "/libs/granite/csrf/token.json" 
        /type "deny" 
    }
```


We willen onze gepubliceerde site zo hebzuchtig mogelijk maken en alles in de cache plaatsen.

Als er elementen zijn die de ervaring breken wanneer caching u regels kunt toevoegen om de optie te verwijderen om dat punt in het voorgeheugen onder te brengen. Zoals u in het voorbeeld hierboven ziet, mogen de csrf-tokens nooit in de cache worden geplaatst en zijn deze uitgesloten. Nadere bijzonderheden over het schrijven van deze regels zijn te vinden [hier](https://experienceleague.adobe.com/docs/experience-manager-dispatcher/using/configuring/dispatcher-configuration.html?lang=en#configuring-the-dispatcher-cache-cache)
