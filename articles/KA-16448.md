---
title: Migreer gebruikers, groepen, en ACLs tussen AEM instanties
description: Beschrijving
solution: Experience Manager
product: Experience Manager
applies-to: Experience Manager
keywords: KCS
resolution: Resolution
internal-notes: 'Helpx Link: https://helpx.adobe.com/experience-manager/kb/migrate-users-groups-ACLs.html ; Contains Docs links that may need to be changed'
bug: false
article-created-by: Gucci Paull
article-created-date: 6/21/2022 6:07:06 PM
article-published-by: Gucci Paull
article-published-date: 6/21/2022 6:07:59 PM
version-number: 8
article-number: KA-16448
dynamics-url: https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=d7ce3bf2-8cf1-ec11-bb3d-6045bd015716
exl-id: 5c285ad4-da35-4ee4-b3d1-3ac9eea5f5b2
source-git-commit: af761579c3fb5e51cf5f4d144bff0e058fd13911
workflow-type: tm+mt
source-wordcount: '954'
ht-degree: 0%

---

# Migreer gebruikers, groepen, en ACLs tussen AEM instanties

## Beschrijving

Hoe te om Gebruikers en Groepen met ACL toestemmingen in AEM van één server aan een andere of van één AEM instantie aan een andere te migreren.

## Resolutie

**Stap 1: Zoek naar de admin en de anonieme gebruikers**

1. Ga naar CRXDE-lijstapp `/crx/de/index.jsp` en aanmelden als beheerder (op het bronsysteem).
1. Ga naar &quot;Tools&quot; = &quot;Query&quot;.
1. Voer onder in het vak &quot;Query&quot; deze query in om de gebruiker van de beheerder te zoeken: *`/jcr:root/home/users//element(\*,rep:User)@rep:principalName="admin" .`*
1. Klik op Uitvoeren en kopieer het pad van het Admin-gebruikersknooppunt in de resultaten naar een tekstbestand.
1. Herhaal stap 3 met een vraag voor anonieme gebruiker: *`/jcr:root/home/users//element(\*,rep:User)@rep:principalName="anonymous" .`*
1. Klik op Uitvoeren en kopieer het pad van het anonieme gebruikersknooppunt in de resultaten naar een tekstbestand (zodat u nu twee paden hebt, een voor &quot;admin&quot; en een voor &quot;anoniem&quot;).

   Bijvoorbeeld:

   `/home/users/Q/QY5FIMXeQIbGpwZtQ3Dv` - Admin user on the source system

   `/home/users/K/Kj1406Qo9IDODc_nk5Ib` - anonieme gebruiker op het bronsysteem

**Stap 2A: Gebruikers en groepen migreren (met `crx2oak` of `oak-upgrade`)**

Gebruikers en groepen kunnen tussen AEM instanties worden gemigreerd met de opdracht [crx2oak](https://helpx.adobe.com/experience-manager/6-4/sites/deploying/using/using-crx2oak.html) of [eik-upgrade](https://jackrabbit.apache.org/oak/docs/migration.html) gereedschappen.

1. Download de `crx2oak` of `oak-upgrade` jar die overeenkomt met de eik-versie die u gebruikt: 
   1. Oak-upgrade: [https://repo1.maven.org/maven2/org/apache/jackrabbit/oak-upgrade](https://repo1.maven.org/maven2/org/apache/jackrabbit/oak-upgrade)
   1. Crx2Oak: [Maven Repository](https://mvnrepository.com/artifact/com.adobe.granite/crx2oak?repo=adobe-public)
1. Upload het jar-bestand naar de AEM server
1. AEM stoppen (bron- en doelinstanties)
1. Vervang de naam van het jar-bestand in de onderstaande opdracht.
1. Vervangen *`/home/users/Q/QY5FIMXeQIbGpwZtQ3Dv,/home/users/K/Kj1406Qo9IDODc_nk5Ib`* in de *`--exclude-paths`* parameter part van het hieronder bevel met de wegen van admin en anonieme gebruikers van uw bronsysteem.
1. De paden op de regel aanpassen aan de instantie (toevoegen *`segment-old:`* vóór het pad, indien nodig, zie hier [https://jackrabbit.apache.org/oak/docs/migration.html](https://jackrabbit.apache.org/oak/docs/migration.html)): *`/opt/aem-source/crx-quickstart/repository /opt/aem-destination/crx-quickstart/repository`*
1. Voer vervolgens de opdracht uit op de shell van de server.

   ```
   java -Xms2g -Xmx2g -jar oak-upgrade-1.8.12.jar \
   --include-paths=/home \
   --merge-paths=/home \
   --exclude-paths=/home/users/Q/QY5FIMXeQIbGpwZtQ3Dv,/home/users/K/Kj1406Qo9IDODc_nk5Ib,/home/groups/a/administrators,/home/groups/a/analytics-administrators,/home/groups/c/community-moderators,/home/groups/c/content-authors,/home/groups/c/contributor,/home/groups/community/community-groupadmin,/home/groups/community/community-sitecontentmanager,/home/groups/community/community-sitemembers,/home/groups/d/dam-users,/home/groups/default/order-administrators,/home/groups/e/everyone,/home/groups/f/forms-users,/home/groups/forms/fd-administrators,/home/groups/forms/forms-users,/home/groups/geometrixx,/home/groups/media,/home/groups/o/operators,/home/groups/projects,/home/groups/t/tag-administrators,/home/groups/t/target-activity-authors,/home/groups/u/user-administrators,/home/groups/w/workflow-editors,/home/groups/w/workflow-users,/home/users/a/admin,/home/users/a/anonymous,/home/users/mac,/home/users/media,/home/users/projects,/home/users/system,/home/rep:policy,/home/users/rep:policy,/home/groups/rep:policy \
   segment-old:/opt/aem-source/crx-quickstart/repository /opt/aem-destination/crx-quickstart/repository  upgradeusers.log &
   ```

1. Zodra voltooid, dan ga naar stap 3 om ACLs te migreren.  Als u niet kunt migreren met `crx2oak` Volg in plaats daarvan de stappen voor pakketmigratie hieronder.

**Stap 2B: Gebruikers en groepen migreren (met pakketten)**

Als gebruikers niet automatisch zijn geïmporteerd via LDAP / SAML-verificatie of `CRX2Oak` (methode A hierboven) kunt u gebruikers en groepen verpakken.  In dit geval maakt u twee afzonderlijke pakketten op het oude systeem (met uitzondering van beheerders en anonieme gebruikers buiten de verpakking).

1. Kopieer de weg van de anonieme en admin gebruikersknopen van de resultaten in Stap 1 (&quot;vind admin en anonieme gebruikers&quot;) hierboven.

   Bijvoorbeeld:

   `/home/users/Q/QY5FIMXeQIbGpwZtQ3Dv` - de beheerder van de gebruiker op het systeem waar ik het pakket maak

   `/home/users/K/Kj1406Qo9IDODc_nk5Ib` - anonieme gebruiker op het systeem waar ik het pakket maak

1. Ga naar &quot;Package Manager&quot;, *`http://host:port/crx/packmgr/index.jsp`* en meld u aan als beheerder.
1. Pakket &quot;gebruikers&quot; maken
1. Een filter toevoegen aan de pakketconfiguratie voor `/home/users` met deze uitsluitingsregels ( `/home/users` filter):
   1. `exclude /home/users/.\*/.tokens`
   1. `exclude /home/users/Q/QY5FIMXeQIbGpwZtQ3Dv`
   1. `exclude /home/users/K/Kj1406Qo9IDODc_nk5Ib`
   1. `exclude /home/users/a/admin`
   1. `exclude /home/users/a/anonymous`
   1. `exclude /home/users/system`
   1. `exclude /home/users/geometrixx`
   1. `exclude /home/users/media`
   1. `exclude /home/users/projects`
   1. `exclude /home/users/mac`
1. Maak het pakket.
1. Download het pakket.
1. Pak het ZIP-bestand van het pakket uit op de computer: `jar -xvf users.zip META-INF/vault/filter.xml`
1. Het bestand openen `META-INF/vault/filter.xml` in een teksteditor.
1. Toevoegen `mode="merge"` op het filter ... tag, bijvoorbeeld:

   ```
   ?xml version="1.0" encoding="UTF-8"?    workspaceFilter version="1.0"    filter root="/home/users" mode="merge"    exclude pattern="/home/users/.*/.tokens"/    exclude pattern="/home/users/Q/QY5FIMXeQIbGpwZtQ3Dv"/    exclude pattern="/home/users/K/Kj1406Qo9IDODc_nk5Ib"/    exclude pattern="/home/users/a/admin"/    exclude pattern="/home/users/a/anonymous"/    exclude pattern="/home/users/system"/    exclude pattern="/home/users/geometrixx"/    exclude pattern="/home/users/media"/    exclude pattern="/home/users/projects"/    exclude pattern="/home/users/mac"/    /filter    /workspaceFilter
   ```

1. Pak de gewijzigde inhoud van het pakket opnieuw in zodat deze de wijziging bevat.

   ```
   jar -uvf users.zip META-INF/vault/filter.xml
   ```

1. Een &quot;groepspakket&quot; maken dat een filterregel bevat `/home/groups`.
1. Herhaal stap 11-14 voor het groepspakket.
1. (Alleen upgrade) Als u een migratie naar een nieuwere AEM uitvoert, installeert u een nieuwe lokale AEM *van de oude versie*(met geen samplinginhoud), installeer het gebruikerspakket en groepspakket daar. Voer vervolgens een upgrade uit op de plaats van de upgrade naar de nieuwe versie op die instantie. Hiermee worden de gebruikers geconverteerd naar de nieuwe oak-weergave. Na de upgrade op de locatie herverpakken de gebruikers opnieuw om ze naar de gewenste geüpgrade instantie te verzenden. Doe het zelfde voor de gebruikersgroepen.
1. Installeer het gebruikerspakket op het nieuwe systeem.
1. Installeer het groepspakket op het nieuwe systeem.
1. Als u van een oudere versie van de AEM naar versie 6.3 migreert, ga dan naar `/useradmin` UI en voeg de gebruiker replicatie-ontvanger aan de &quot;beheerders&quot;groep toe.

**Stap 3. ACL&#39;s migreren**

Als u hulpmiddelen (ACS Commons) aan AEM kunt installeren, dan volg deze stappen:

1. ACS-opdrachten downloaden en installeren.
1. Volg de stappen hier worden verstrekt om een ACL pakket tot stand te brengen dat.
1. Ga naar http://aem-host:port/crx/packmgr/index.jsp and login als admin.
1. Klik het ACL pakket.
1. Klik op Bewerken.
1. Selecteer [!UICONTROL Advanced] tabblad (zie onderstaande schermafbeelding).
1. Selecteer in het vervolgkeuzemenu AC-verwerking de optie [!UICONTROL Merge] vermijden verwijderend bestaande ACLs op het bestemmingssysteem. Dit is vooral belangrijk wanneer het migreren van ACLs tussen verschillende versies van AEM (aangezien het het verwijderen uit de doos ACLs vermijdt).

Als u *niet* kan hulpmiddelen (ACS Commons) aan AEM installeren, dan deze stappen volgen. De computer waarop u deze opdrachten uitvoert, moet Mac OS zijn. [!DNL Linux], of [!DNL Windows] (gebruiken [!DNL Cygwin]) met cURL, [!DNL Python], en [!DNL Java] SDK geïnstalleerd.

1. Ga naar http://src-aem-host:port/crx/packmgr/index.jsp and login als admin.
1. Creeer een pakket genoemd &quot;ACL-migratie&quot;
1. Klik op de knop Bewerken.
1. Selecteer [!UICONTROL Advanced] en stel de AC-verwerkingsmodus in op Samenvoegen.
1. Opslaan.
1. Maak het pakket en download het.
1. Voer deze opdracht in het bestandssysteem uit op het pakket om het `META-INF/vault/filter.xml` bestand: 

   ```
   jar -xvf ACL-migration-1.0.zip META-INF/vault/filter.xml
   ```

1. In de zelfde folder, stel dit bevel in werking om een verbindingsdossier van de ACL wegen onder te downloaden `/content` van de broninstantie (stel de gebruikersnaam en het wachtwoord in en corrigeer de host): 

   ```
   curl -u admin:admin 'http://aemhost/crx/de/query.jsp?' -G --data-urlencode '_dc=1507011481908&_charset_=utf-8&type=xpath&stmt=/jcr:root/content//element(*,rep:ACL)&showResults=true'  data.json
   ```

1. Een bestand maken `generate-package-filter.py` en plak de [!DNL Python] code eronder: 

   ```
   import json
   from pprint import pprint
   
   with open ('data.json') as data_file:
      data = json.load(data_file)
   
   print("?xml version=\"1.0\" encoding=\"UTF-8\"?")
   print("workspaceFilter version=\"1.0\"")
   
   for item in data "results":
       print("filter root=\"{path}\" /" . format(path=item "path"))
   
   print( "/workspaceFilter")
   ```

1. Voer de [!DNL Python] script uit dezelfde map als data.json is gemaakt en de uitvoer wordt opgeslagen in `META-INF/vault/filter.xml` (vervangt de bestaande inhoud van `filter.xml`): 

   ```
   python generate-packge-filter.py  META-INF/vault/filter.xml
   ```

1. Gebruik deze opdracht om de `filter.xml` in het ZIP-bestand:

   ```
   jar -uvf ACL-migration-1.0.zip META-INF/vault/filter.xml
   ```

1. Upload het ZIP-bestand naar het pakketbeheer voor de broninstantie: http://src-aem-host:port/crx/packmgr/index.jsp
1. Klikken [!UICONTROL Build] of [!UICONTROL Rebuild] om het pakket samen te stellen.
1. Download het pakket van de bron AEM server.
1. Upload het pakket naar het pakketbeheer van de AEM server: http://dst-aem-host:port/crx/packmgr/index.jsp
1. Klikken [!UICONTROL Install] om het te installeren.
1. Herhaal stap 8-16 voor alle andere paden die de opdracht Padkrullen wijzigen. Bijvoorbeeld, zou dit ACLs onder krijgen `/etc` in plaats van `/content`:

   ```
   curl -u admin:admin 'http://aemhost/crx/de/query.jsp?' -G --data-urlencode '_dc=1507011481908&_charset_=utf-8&type=xpath&stmt=/jcr:root/etc//element(*,rep:ACL)&showResults=true'  data.json` |
   ```
