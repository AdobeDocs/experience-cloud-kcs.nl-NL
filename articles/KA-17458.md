---
title: Optimaliseren van de [!DNL Dispatcher] cachegeheugen
description: Beschrijving
solution: Experience Manager
product: Experience Manager
applies-to: Experience Manager
keywords: KCS
resolution: Resolution
internal-notes: null
bug: false
article-created-by: Roxann McGlumphy
article-created-date: 10/20/2021 7:12:29 PM
article-published-by: Cedric Latimier
article-published-date: 1/18/2022 1:45:44 PM
version-number: 1
article-number: KA-17458
dynamics-url: https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=ee6e74a7-d931-ec11-b6e5-000d3a5ba97a
exl-id: 84871fce-d53d-4a1d-aabf-ccf8c8c47810
source-git-commit: 0c3e421beca46d9fe1952b1f98538a50697216a0
workflow-type: tm+mt
source-wordcount: '1409'
ht-degree: 0%

---

# Optimaliseren van de [!DNL Dispatcher] cachegeheugen

## Beschrijving


Dit artikel richt zich op de nieuwste optimalisaties in de AEM Dispatcher en hoe u deze optimaal kunt benutten.  De AEM Dispatcher is een caching [reverse, proxy](https://stackoverflow.com/questions/224664/difference-between-proxy-server-and-reverse-proxy-server) server die is ontworpen voor gebruik met Adobe Experience Manager.  Het kan als een module binnen bestaande software van de Webserver worden geïnstalleerd en worden uitgevoerd.  Op het moment dat u dit artikel schrijft, worden de [dispatchermodule wordt ondersteund](https://helpx.adobe.com/experience-manager/dispatcher/using/dispatcher-install.html) op [!DNL Apache HTTP Server], Microsoft IIS en [!DNL iPlanet].


## Resolutie

<br><br>Hoe het in cache plaatsen van Dispatcher werkt<br><br><br><br><br><br>
Op het eenvoudigste niveau is de AEM Dispatcher een reverse-proxy die werkt door caching, leegmaken van cache en het ongeldig maken van cache uit te voeren.

Zie de verwante koppelingen voor meer informatie over dispatcher:

1. [Hoe de verzender werkt en hoe deze wordt geïnstalleerd](https://helpx.adobe.com/experience-manager/dispatcher/using/dispatcher.html).
2. [Configuratieopties beschikbaar in de dispatcher](https://helpx.adobe.com/experience-manager/dispatcher/using/dispatcher-configuration.html).
3. [Webinar over de werking van de verzender](https://github.com/cqsupport/webinar-dispatchercache) - sommige informatie in de presentatie is gebaseerd op oude versies van de verzender.
4. [Gems-webinar-sessie over functies voor het verzenden, gebruik en beveiliging van CDN](https://docs.adobe.com/ddc/en/gems/dispatcher-caching---new-features-and-optimizations.html).
5. [Gems-sessie over nieuwere functies in dispatcher (na v4.1.9)](https://helpx.adobe.com/experience-manager/kt/eseminars/gems/aem-dispatcher.html).

<br><br><br><br><br><br>De Dispatcher Cache optimaliseren<br><br><br><br><br><br>
Hier volgen enkele manieren om de verzendingscache te optimaliseren:

1. <b>Bijna alles opslaan</b> - dit betekent dat inhoud die meerdere keren door gebruikers wordt opgevraagd, in het cachegeheugen wordt opgeslagen.
2. <b>Persoonlijke inhoud voor verschillende tijdsperioden in de cache opslaan</b> - Als uw site persoonlijke inhoud bevat, kunt u het beste [[!DNL Apache Sling Dynamic Includes]](https://helpx.adobe.com/experience-manager/kt/platform-repository/using/sling-dynamic-include-technical-video-setup.html) in uw AEM toepassing [!DNL Ajax] (Asynchrone JavaScript- en XML-aanroepen op browserniveau), SSI (Server Side Includes at the Web Server level) en ESI (Edge-side Includes at the CDN level) om verschillende delen van de pagina gedurende verschillende perioden in het cachegeheugen op te slaan.
3. <b>De verzendingscache nooit verwijderen op een live dispatcher</b> - Als een verzender live-inhoud verzorgt en u de cache verwijdert, zal dit leiden tot een enorme stroom verzoeken om terug te gaan naar AEM.  Hierdoor mag de verzendingscache nooit worden verwijderd op een live verzender.
4. <b>Cache opknappen </b>- Voordat u de [!DNL Dispatcher] cache, trekken de [!DNL Dispatcher] Verwijder het taakverdelingsmechanisme uit uw taakverdelingsmechanisme en voer vervolgens een webcrawler-programma uit om bestanden op de verzender in cache te plaatsen voordat u deze op het taakverdelingsmechanisme plaatst.
5. <b>Cachefoutpagina&#39;s</b> - Gebruik de <b>[DispatcherPassError 1](https://helpx.adobe.com/experience-manager/dispatcher/using/dispatcher-install.html#ApacheWebServer) </b>([!DNL Apache] Web Server-specifiek) aanwijzing om foutenpagina&#39;s zoals 404s van het berichtchergeheime voorgeheugen te dienen.
6. <b>GZip comprimeert alle bestandstypen behalve die welke vooraf zijn gecomprimeerd </b>- In [!DNL Apache] Webserver, [mod_deflate](https://httpd.apache.org/docs/2.4/mod/mod_deflate.html) kan worden gebruikt, maar zorg ervoor dat <b>`Vary: User-Agent` </b>header<b> </b>is niet ingesteld.  In Microsoft IIS: gebruiken [Dynamische compressie](https://docs.microsoft.com/en-us/iis/configuration/system.webserver/httpcompression/).

   [!DNL Apache] configuratievoorbeeld (alleen bepaalde inhoudstypen opgeven om vooraf gecomprimeerde bestandstypen te voorkomen):

   `AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript`
7. <b>Inschakelen [/serveStaleOnError](https://helpx.adobe.com/experience-manager/kb/ServeStaleContentOnError.html)</b> in de `/cache` configuratie - bedient het oude cachebestand wanneer AEM instanties fouten bedienen.
8. <b>Toevoegen [/nl/respijtperiode](https://docs.adobe.com/content/help/en/experience-manager-dispatcher/using/configuring/dispatcher-configuration.html#configuring-the-dispatcher-cache-cache)</b> aan de `/cache` configuratie - definieer het aantal seconden dat een niet-gevalideerde, oplaadbare resource mogelijk nog steeds uit de cache wordt geladen nadat de laatste publicatiegebeurtenis voor inhoud is verzonden (&quot;activering&quot;).  Hierdoor wordt het aantal aanvragen verminderd dat teruggaat naar de publicatie-instanties tijdens een grote publicatiebewerking voor inhoud, zoals een structuuractivering.
9. <b>Regels toevoegen aan [/ignoreUrlParams](https://helpx.adobe.com/experience-manager/dispatcher/using/dispatcher-configuration.html#IgnoringURLParameters)</b> - de parameters van querystring negeren die niet vereist of gebruikt worden door de toepassing.  Dit staat caching van URLs toe zelfs wanneer een querystring aanwezig is.
10. <b>Plaats de antwoordheaders voor Cache-Control en Last-Modified (Laatst gewijzigd) in de cache</b> - Gebruik de<b> [/headers](https://helpx.adobe.com/experience-manager/dispatcher/using/dispatcher-configuration.html#CachingHTTPResponseHeaders)</b> configuratie om de HTTP-antwoordheaders in cache te plaatsen <b>`Cache-Control`</b> en <b>`Last-Modified` </b>(en/of <b>`ETag`</b> koptekst als uw gegevens vanuit AEM worden verzonden).  Dit helpt bij het vereenvoudigen en optimaliseren van caching op CDN- en browserniveau.  In cache plaatsen van deze headers zorgt dat alleen AEM de kopteksten worden ingesteld, niet de webserver zelf.  Wanneer u dit doet, moet u beginnen met het verzenden van de headers vanuit de AEM toepassing.
11. <b>Inhoud zo lang mogelijk in cache plaatsen</b> en <b>vermindert verzoeken terug naar AEM</b> - Verzoeken om te spoelen optimaliseren door [opnieuw plaatsen](https://helpx.adobe.com/experience-manager/kb/optimizing-the-dispatcher-cache.html#refetching-flush) Alle spoelmiddelen uitspoelen.  of gebruiken [<b>/enableTTL</b>](https://helpx.adobe.com/experience-manager/kb/optimizing-the-dispatcher-cache.html#use-ttls) en instellen <b>`Cache-Control: max-age=...`</b> om bestanden zo lang mogelijk in het cachegeheugen op te slaan.  Zie [onder](https://helpx.adobe.com/experience-manager/kb/optimizing-the-dispatcher-cache.html#use-ttls) voor meer informatie over dit onderwerp.

<br><br><br><br><br><br>Het gebruiken van TTLs<br><br><br><br><br><br>
Vanaf [!DNL Dispatcher] versie 4.1.11, [/enableTTL 1](https://helpx.adobe.com/experience-manager/dispatcher/using/dispatcher-configuration.html#ConfiguringTimeBasedCacheInvalidationenableTTL) kan worden ingesteld in de `.any` bestandsconfiguratie.  Met deze instelling worden verlopen in de cache van de verzender met respect ingesteld in de HTTP `Cache-Control` responsheader.  Met andere woorden, de verzender werkt ongeveer op dezelfde manier als een CDN, waar de primaire vorm van cachevervalsing optreedt wanneer bestanden verlopen.  Zodra u dit implementeert en begint met verzenden <b>`Cache-Control: max-age=...` </b>voor alle reacties van AEM, dan kunt u veilig uw verzender afvlakkingsagenten in publiceren instanties onbruikbaar maken.

Na het onbruikbaar maken van spoelagenten op de publiceer instanties dan kunt u nog het berichtchergeheime voorgeheugen willen kunnen leegmaken.  In dat geval kunt u [ACS-komma&#39;s - Dispatcher Flush UI](https://adobe-consulting-services.github.io/acs-aem-commons/features/dispatcher-flush-ui/index.html).  Dit gereedschap is geïnstalleerd op de instantie van de auteur.  Het geeft gebruikers een UI waar zij manueel geheim voorgeheugenspoelverzoeken kunnen uitvoeren.

<b>I. Stappen voor het inschakelen van validaties van de stijl TTL (&quot;Tijd om te leven&quot; of verlopen):</b>

1. Broncode in de AEM-toepassing wijzigen om te verzenden <b>`Cache-Control` </b>en <b>`Last-Modified` </b>voor alle aanvragen waarvoor dit nog niet is ingesteld.
2. Installeren [!DNL Dispatcher] 4.1.11 of hoger.
3. Set <b>[/enableTTL 1](https://helpx.adobe.com/experience-manager/dispatcher/using/dispatcher-configuration.html#ConfiguringTimeBasedCacheInvalidationenableTTL)</b> in de `.any` landbouwbedrijfsconfiguratie van de plaats.
4. Stel de <b>[/headers](https://helpx.adobe.com/experience-manager/dispatcher/using/dispatcher-configuration.html#CachingHTTPResponseHeaders) </b>configuratie om de <b>`Cache-Control`</b> en <b>`Last-Modified`</b> kopteksten.
5. Start de webserver opnieuw.


<b>II. Schakel dispatcher flush agents uit op de publicatie-instanties:</b>

De verzender gebruikt nu de `Cache-Control` header om de validatie van de cachebestanden te beheren.  Aangezien dat het geval is, is het niet langer nodig om de verzender uit de publicatie-instanties te spoelen.

1. Ga naar `/etc/replication/agents.publish.html` op elke publicatie-instantie.
2. Ga naar de configuratie van elke spoelagent en maak de agent onbruikbaar.


<b>III. Handmatige verzoeken van de auteur om het verzenden van het bestand toestaan:</b>

Nu de spoelmiddelen worden uitgeschakeld, bent u volledig afhankelijk van de <b>`Cache-Control` </b>om te bepalen wanneer de inhoud op de verzender wordt vernieuwd.  U kunt gebruikers nog steeds toestaan handmatige flushes van de verzenderscache uit te geven:

1. Installeren [ACS-komma&#39;s - Dispatcher Flush UI](https://adobe-consulting-services.github.io/acs-aem-commons/features/dispatcher-flush-ui/index.html) op de instantie van de auteur.
2. Vorm spoelagenten op de auteursinstantie.
3. In elk van de agentenconfiguraties, reeks <b>Triggers</b> = <b>Standaardwaarde negeren </b>in te schakelen. Met deze optie worden de uitlijningsmiddelen genegeerd wanneer de gebruiker op <b>(Niet beschikbaar) Publiceren </b>of <b>(De)Activeren</b> in de AEM-gebruikersinterface.

<br><br><br><br><br><br>Dispatcher Flush opnieuw ophalen<br><br><br><br><br><br>
Om de verzoeken van de de flush van de verzender te optimaliseren, zouden alle verzender agenten een eigenschap moeten hebben die het opnieuw plaatsen van blos wordt toegelaten.

Voer de volgende handelingen uit om het leegmaken van de terughaaldispatcher in te schakelen:

1. Ga naar <b>*http://aemhost:port*/crx/packmgr/index.jsp</b> en aanmelden als beheerder.
2. Download het pakket van [hier](https://github.com/cqsupport/webinar-dispatchercache/blob/master/packages/dispatcher-flush-refetch-samplecode-1.0.zip?raw=true).
3. Upload en installeer het pakket naar pakketbeheer.
4. Ga naar de configuratie van de verzendingsagent. Bijvoorbeeld <b>/etc/replication/agents.author/flush.html</b>
5. Klik op <b>[!UICONTROL Edit]</b>
6. Het volgende instellen
   - <b>Type serienummering</b> = <b>Dispatcher Flush opnieuw ophalen</b>
   - <b>Uitgebreid</b> = <b>HTTP-methode</b> = <b>POST</b>
7. Klik op <b>[!UICONTROL Save]</b>


Het hierboven geïnstalleerde pakket is slechts een eenvoudig voorbeeld.  Als u het leegmaken wilt aanpassen en optimaliseren, kunt u de lijst met URI&#39;s wijzigen die door het verwijderen worden verzonden.  De code is een open bron en kan worden gevonden [hier](https://github.com/cqsupport/webinar-dispatchercache/tree/master/src/refetching-flush-agent/refetch-bundle).  De code voegt een lijst van URIs aan het verzoeklichaam als parameters toe die verzender vertellen welke wegen om opnieuw te halen.  U kunt meer paden toevoegen volgens de vereisten van uw toepassing om de mogelijkheden voor het in cache plaatsen van uw site te optimaliseren.
<br><br><br><br><br><br>Een gedetailleerdere uitleg van het opnieuw ophalen van de flush<br><br><br><br><br><br>
Een verzender wordt normaal gesproken leeggemaakt door bestanden te verwijderen:

1. Aanraken `.stat` bestand(en)
2. Verwijderen `/content/foo.\*`
3. Verwijderen `/content/foo/_jcr_content`


Omdat bestanden in stap 2 worden verwijderd, kan de volgende keer dat een gebruiker een bestand zoals `/content/foo.html` of `/content/foo.json`Terwijl het bestand opnieuw wordt opgehaald, worden volgende aanvragen voor hetzelfde bestand ook naar de publicatie-instanties verzonden totdat het bestand in de cache is geplaatst.  Voor trage reacties of zware verkeerspagina&#39;s zoals homepages kan dit overstromingen van de publicatiereeks veroorzaken.

Om dit probleem op te lossen, laat een eigenschap van de verzender toe genoemd herophaalden.  Met deze functie kunt u een lijst met URI&#39;s verzenden die de verzender proactief &quot;opnieuw ophaalt&quot; en in plaats daarvan verwijdert.

Zie 22:41-27:05 [presentatieopname](https://my.adobeconnect.com/p7th2gf8k43) voor een demo van hoe het werkt en hoe te om het te vormen.
